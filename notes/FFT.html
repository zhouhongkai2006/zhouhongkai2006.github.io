<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="/favicon.ico" rel="shortcut icon">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" name="viewport">
    <title>FFT详解 - dblark's blog</title>


    <link href="/css/base.min.css" rel="stylesheet">
    <link href="/css/project.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="/css/gitalk.css" rel="stylesheet">


    <script type="text/x-mathjax-config">
  		MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>
    function getCookie(c_name)
    {
    if (document.cookie.length>0)
      {
      c_start=document.cookie.indexOf(c_name + "=")
      if (c_start!=-1)
        {
        c_start=c_start + c_name.length+1
        c_end=document.cookie.indexOf(";",c_start)
        if (c_end==-1) c_end=document.cookie.length
        return unescape(document.cookie.substring(c_start,c_end))
        }
      }
    return ""
    }

    var cookie=getCookie("Language")
    if (cookie=="")
    {
      cookie="pascal"
    }
    if (cookie=="pascal")
    {
      document.write("<style type=\"text/css\">.c\\+\\+{display:none;}</style>")
    }
    if (cookie=="c++")
    {
      document.write("<style type=\"text/css\">.pascal{display:none;}</style>")
    }
    </script>

</head>
<body class="page-brand">


	 <nav class="menu menu-left nav-drawer nav-drawer-md" id="ui_menu">
		 <div class="menu-scroll">
			 <div class="menu-content">
				 <a class="menu-logo" href="/">周圣杰的博客</a>
				 <ul class="nav">
					 <li>

						 <a class="collapsed waves-attach waves-effect" data-toggle="collapse" href="#notes">学习笔记</a>
						 <ul class="menu-collapse collapse in" id="notes">

							 <li>
								 <a class="waves-attach" href="/notes/ST.html">浅析ST表</a>
							 </li>
							 <li class="active">
								 <a class="waves-attach" href="/notes/FFT.html">FFT详解</a>
							 </li>

						 </ul>
						 <a class="collapsed waves-attach waves-effect" data-toggle="collapse" href="#pascal">Pascal语法</a>
						 <ul class="menu-collapse collapse in" id="pascal">

							 <li>
								 <a class="waves-attach" href="/pascal/operator.html">运算符重载</a>
							 </li>

						 </ul>
						 <a class="collapsed waves-attach waves-effect" data-toggle="collapse" href="#travels">游记</a>
						 <ul class="menu-collapse collapse in" id="travels">

							 <li>
								 <a class="waves-attach" href="/travels/NOIP2018.html">NOIP2018普及组游记</a>
							 </li>

					 </li>

				 </ul>
			 </div>
		 </div>
	 </nav>

    <header class="header header-transparent header-waterfall ui-header">
        <ul class="nav nav-list pull-left hidden-md hidden-lg">
            <li>
                <a data-toggle="menu" href="#ui_menu">
                    <span class="icon icon-lg">menu</span>
                </a>
            </li>
        </ul>
        <span class="header-logo header-affix visible-md-block visible-lg-block margin-right-no" data-offset-top="0" data-spy="affix">
            <p class="pagetitle">FFT详解</p>
        </span>

        <ul class="nav nav-list pull-right">
            <li>
                <a data-toggle="menu" href="/">
                    <span class="avatar avatar-sm"><img alt="icon" src="/favicon.ico"></span>
                </a>
            </li>
        </ul>
    </header>
    <main class="content">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-lg-offset-3 col-md-10 col-md-offset-1">
                    <section class="content-inner margin-top-no">
                        <br>

<h1 id="fft">FFT详解</h1>
<blockquote>
<p>话说这个算法是大佬才能写的</p>
<p>可是为了写库，只好学了一下</p>
</blockquote>
<p>FFT，就是快速傅里叶转换（Fast Fourier Transition）。这个算法可以把高精度乘法的复杂度$O(n^2)$降到$O(n log n)$。另外，它还有很多的用途。</p>
<p>但在这之前，让我们先了解一下高精度乘法为何需要FFT的帮助。</p>
<h2>多项式乘法</h2>
<p>了解一下，事实上，我们一般用的手工乘法就是多项式乘法。</p>
<p>比如两个三位数相乘：</p>
<p>$$f(x)=a_1x^2+a_2x+a_3$$</p>
<p>$$g(x)=b_1x^2+b_2x+b_3$$</p>
<p>令它们的积为$p(x)$：</p>
<p>$$p(x)=f(x)\times g(x)=a_1b_1x^4+(a_1b_2+a_2+b_1)x^3+(a_1b_3+b_2a_2+a_2+b_2)x^2+(a_2+b_3+b_2+a_3)x+a_3+b_3$$</p>
<p>但是，一般来说我们都是用点值表达法而不是系数表达法。比如：</p>
<p>$$f(x)=a_0+a_1x+a_2x^2+\cdots +a_nx^n \Leftrightarrow f(x)=\{a_n,a_n-1,\cdots ,a_1,a_0\}$$</p>
<p>不过，一般来说我们不可能写出这样的运算结果：$f(x)=\{5,16,2,4\}$，所以，还需要把它整理一下。这是题外话。</p>
<p>反正，这样乘下来，复杂度就是$O(length(f(x))\times length(g(x)))=O(n^2)$，如果$length(f(x))\times length(g(x))&gt;10^5$，那么时间就会炸。</p>
<p>所以，在处理特别大的数字时，这样肯定不行的。</p>
<p>那么，FFT就神奇的帮上了忙。实现的办法待会再说。</p>
<h2 id="-1">傅里叶级数</h2>
<p>傅里叶变换的本源是傅里叶级数。就跟幂级数差不多。</p>
<p>幂级数：“我用$x^na_n+x^{n-1}a_{n-1}+\cdots+x^1a_1+x^0a_0$可以表示世界上所有的函数！”</p>
<p>傅里叶级数：“我用$sinx\times1,sinx\times2,sinx\times3\cdots$和$cosx\times1,cosx\times2,cosx\times3\cdots$加上系数也可以表示世界上所有的函数！”</p>
<p><strong>所以，我们知道傅里叶级数的所有系数，就能够求出对应的函数式。</strong></p>
<p><strong>反过来，知道函数式，也能求出傅里叶级数的所有系数。</strong></p>
<p>这就是傅里叶变换的基础。</p>
<p><del>傅里叶系数就是一个函数的<strong>坐标</strong>。真是弱爆了。</del></p>
<h2 id="-2">离散傅里叶变换</h2>
<p>离散傅里叶变换就是DFT。看上去很高深，实际上很简单。</p>
<p>我们知道，一个函数有系数表达法和点值表达法。</p>
<p>那么，将$f(x)$转换成在不同的$x$时的$y$，就是DFT。</p>
<p>当然，还有对应的逆傅里叶变换IDFT。</p>
<p>就是给定不同的坐标，求出函数式。</p>
<p>但是，IDFT有一个限制，就是一个$n$次的$f(x)$有$n+1$个系数，必须要$n+1$个不同的坐标才能求出函数式，这个<del>线性代数</del>可以自己去推导。</p>
<p><del>傅里叶变换中将<strong>坐标称为时域</strong>，<strong>系数称为频域</strong>，很奇怪是吧。</del></p>
<p>为什么傅里叶变换能实现快速乘法呢？因为时域相乘不是多项式乘法，只要一项一项乘过来就行了。听上去不错。</p>
<p>但是，既然DFT是个算法，就要谈谈它的复杂度。</p>
<p>一个坐标需要$O(n)$，那么整个DFT就需要$O(n^2)$的复杂度。</p>
<p>然后……跟多项式乘法的复杂度一样了。</p>
<p>IDFT更高，根据高斯消元，复杂度变成了$O(n^3)$。</p>
<p>那么，这个算法不就没用了吗？</p>
<p>不过，它给FFT提供了基础。主人公就要出场了。</p>
<h2 id="-3">快速傅里叶变换</h2>
<h3 id="-4">递归实现</h3>
<p>FFT很奇妙，它只要$O(n log n)$就能搞定频域到时域，IFFT的时域到频域也只需要这么点复杂度。</p>
<p>当然，这么好的东西，也是要付出代价的。</p>
<p>首先，这个函数里的次数必须要是$2^n-1$，不是的话可以强行用0补上。这是小问题。</p>
<p>还有一个限制，$x$也不能任意取。</p>
<p>我们知道，只要任意$n$个$x$就能构成时域。（这里的$n$是系数的个数）</p>
<p>但是，FFT告诉你，做不到。如果你要$x=1,2,3,4,\cdots$，只能老老实实$O(n^2)$。</p>
<p>所以，到底$x$要取什么？</p>
<p>答案：$x^n=1$的所有根。</p>
<p>好吧，所以我们就知道了，这是一系列的复根：$\{w_n^0,w_n^1,w_n^2,\cdots,w_n^{n-1}\}$在算法导论上定义了一个符号：$w_n^k$。$k$是$k$次方的意思。通过关于复数的知识，我们可以推导出：</p>
<p>$$w_n=e^{2\pi i}$$</p>
<p>那么，$x$的问题就解决了。</p>
<p>FFT是如何求出对应的$y$的呢？跟另一种快速多项式乘法差不多，也是分治。</p>
<p>我们可以构造两个次数为$n/2$的函数。</p>
<p>$$f_1(x)=a_0+a_2x+a_4x^2+...+a_{n-2}x^{n/2-1}$$</p>
<p>$$f_2(x)=a_1+a_3x+a_5x^2+...+a_{n-1}x^{n/2-1}$$</p>
<p>所以，原问题就变成了：</p>
<p>$$f(x)=f_1(x^2)+x\times f_2(x^2)$$</p>
<p>如此下去，直到只有一项为止。这时问题就变成了常数项，直接返回即可。这是边界条件。</p>
<p>然而，现在又有个小问题，函数里多了一个平方。根据棣莫弗公式，复数的平方就是辐角乘二，因此，根据$w_{dn}^{dk}=w_n^k$相消定理，$(w_n)^2$就能变成$w_{n/2}$了。</p>
<p>那么，我们如此递归下去，就跑出了结果。</p>
<p>但是，还有时域到频域的IFFT。这部分比较复杂，不愿意看的可以略过（结果很简单）。</p>
<p><del>呵呵又是线性代数</del></p>
<p>从频域到时域，其实就是频域的$n$个系数组成一个列，然后乘一个$n^2$矩阵，得到另一个列，而这个列就是$y$坐标组成的列。</p>
<p>$$ \left( \begin{matrix} y_0 \\ y_1 \\ y_2 \\ y_3 \\ \vdots \\ y_{n-1} \\ \end{matrix} \right) =\left( \begin{matrix} 1 &amp; 1 &amp; 1 &amp; 1 &amp; \cdots &amp; 1 \\ 1 &amp; w_n &amp; w_n^2 &amp; w_n^3 &amp; \cdots &amp; w_n^{n-1} \\ 1 &amp; w_n^2 &amp; w_n^4 &amp; w_n^6 &amp; \cdots &amp; w_n^{2(n-1)} \\ 1 &amp; w_n^3 &amp; w_n^6 &amp; w_n^9 &amp; \cdots &amp; w_n^{3(n-1)} \\ \vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\ 1 &amp; w_n^{n-1} &amp; w_n^{2(n-1)} &amp; w_n^{3(n-1)} &amp; \cdots &amp; w_n^{(n-1)(n-1)} \\ \end{matrix} \right) \left( \begin{matrix} a_0 \\ a_1 \\ a_2 \\ a_3 \\ \vdots \\ a_{n-1} \\ \end{matrix} \right) $$</p>
<p>这其实就是把$w_n^k$带进多项式后的式子。</p>
<p>为什么我用矩阵乘法呢？那是因为，一个矩阵$M$如果是可逆的，那么$y=a\times M$就可以变成$y\times \frac{1}{M}=a$了。就是说，可以完成从时域到频域的转换。</p>
<p>线性代数中，把这个矩阵称作<strong>范德蒙矩阵</strong>，是可逆的。还帮我们算好了它的逆：</p>
<p>$$ \frac{1}{n} \left( \begin{matrix} 1 &amp; 1 &amp; 1 &amp; 1 &amp; \cdots &amp; 1 \\ 1 &amp; w_n^{-1} &amp; w_n^{-2} &amp; w_n^{-3} &amp; \cdots &amp; w_n^{-(n-1)} \\ 1 &amp; w_n^{-2} &amp; w_n^{-4} &amp; w_n^{-6} &amp; \cdots &amp; w_n^{-2(n-1)} \\ 1 &amp; w_n^{-3} &amp; w_n^{-6} &amp; w_n^{-9} &amp; \cdots &amp; w_n^{-3(n-1)} \\ \vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\ 1 &amp; w_n^{-(n-1)} &amp; w_n^{-2(n-1)} &amp; w_n^{-3(n-1)} &amp; \cdots &amp; w_n^{-(n-1)(n-1)} \\ \end{matrix} \right) $$</p>
<p>你可能会想：矩阵乘法可是$O(n^3)$的，有这个矩阵有什么用啊？</p>
<p>没事，既然我们当初把FFT理解成了矩阵，再把矩阵理解成FFT就行了。</p>
<p><del>理解结束了，下面是结果</del></p>
<p>我们把得到的时域$y$理解为新的一组系数，把要求的频域$a$理解为新的一组$y$坐标，然后新选取的一组$x$坐标是$w_n^{-1},w_n^{-2},\cdots$</p>
<p>也就是说，我们可以依葫芦画瓢，使用FFT实现从时域到频域，只是选取的$x$坐标换了，并且最后得到的结果要除以一个$n$。</p>
<p>好了这个问题就解决了。</p>
<h3 id="-5">蝴蝶操作</h3>
<p>我们都知道，复数的乘法速度很慢。所以，我们要尽量避免单位复根的计算<del>或者打表</del>。</p>
<p>我们知道每个$f_1$和$f_2$的系数都要用两次，让我们把这两次写出来看看：</p>
<p>第一次：</p>
<p>$$f(w_n^k)=f_1(w_n^{2k})+w_n^kf_2(w_n^{2k})$$</p>
<p>第二次：</p>
<p>$$f(w_n^{k+\frac{n}{2}})=f_1(w_n^{2k+n})+w_n^{k+\frac{n}{2}}f_2(w_n^{2k+n})$$</p>
<p>整理后得到：</p>
<p>$$f(w_n^{k+\frac{n}{2}})=f_1(w_n^{2k})-f_2(w_n^{2k})$$</p>
<p>所以呢，这个结论大家应该一看就明白了，我们把复杂度降低了一半！</p>
<p><del>这个速度也快了没多少啊</del></p>
<p>递归版代码：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode pascal"><code class="sourceCode pascal"><a class="sourceLine" id="cb1-1" title="1"><span class="co">//Pascal没有关于复数的库，所以自己写了个imaginary库，代码详见我的GitHub</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="ot">{$M 100000000,0,0}</span>             <span class="co">//栈容量扩充，不然会炸</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">uses</span></a>
<a class="sourceLine" id="cb1-4" title="4">math,imaginary;</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">type</span>                           <span class="co">//数组定义</span></a>
<a class="sourceLine" id="cb1-6" title="6">arr=<span class="kw">array</span>[<span class="dv">0</span>..<span class="dv">8191</span>]<span class="kw">of</span> complex;</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">var</span></a>
<a class="sourceLine" id="cb1-8" title="8">n1,n2,n3,i:<span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb1-9" title="9">a,b,c:arr;</a>
<a class="sourceLine" id="cb1-10" title="10">s:<span class="kw">array</span>[<span class="dv">0</span>..<span class="dv">8191</span>]<span class="kw">of</span> <span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb1-11" title="11">s1,s2:<span class="dt">string</span>;</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">procedure</span> fft(a:arr;<span class="kw">var</span> y:arr;n,s:<span class="dt">longint</span>);</a>
<a class="sourceLine" id="cb1-13" title="13"> <span class="kw">var</span></a>
<a class="sourceLine" id="cb1-14" title="14"> f1,f2,y1,y2:arr;</a>
<a class="sourceLine" id="cb1-15" title="15"> w:complex;</a>
<a class="sourceLine" id="cb1-16" title="16"> x,i:<span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb1-17" title="17"> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb1-18" title="18"> <span class="kw">if</span> n=<span class="dv">1</span> <span class="kw">then</span>                   <span class="co">//边界条件</span></a>
<a class="sourceLine" id="cb1-19" title="19"> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb1-20" title="20"> y:=a;</a>
<a class="sourceLine" id="cb1-21" title="21"> <span class="kw">exit</span>;</a>
<a class="sourceLine" id="cb1-22" title="22"> <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb1-23" title="23"> <span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n <span class="kw">div</span> <span class="dv">2-1</span> <span class="kw">do</span>      <span class="co">//将数组分割成两部分</span></a>
<a class="sourceLine" id="cb1-24" title="24"> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb1-25" title="25"> f1[i]:=a[i*<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb1-26" title="26"> f2[i]:=a[i*<span class="dv">2</span>+<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb1-27" title="27"> <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb1-28" title="28"> fft(f1,y1,n <span class="kw">div</span> <span class="dv">2</span>,s);         <span class="co">//递归</span></a>
<a class="sourceLine" id="cb1-29" title="29"> fft(f2,y2,n <span class="kw">div</span> <span class="dv">2</span>,s);</a>
<a class="sourceLine" id="cb1-30" title="30"> <span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n <span class="kw">div</span> <span class="dv">2-1</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-31" title="31"> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb1-32" title="32"> w:=exp(<span class="dt">comp</span>(<span class="dv">0</span>,<span class="dv">2</span>*pi*i*s/n));   <span class="co">//复根的计算</span></a>
<a class="sourceLine" id="cb1-33" title="33"> y[i]:=y1[i <span class="kw">mod</span> (n <span class="kw">div</span> <span class="dv">2</span>)]+w*y2[i <span class="kw">mod</span> (n <span class="kw">div</span> <span class="dv">2</span>)];<span class="co">//计算出结果</span></a>
<a class="sourceLine" id="cb1-34" title="34"> y[i+n <span class="kw">div</span> <span class="dv">2</span>]:=y1[i <span class="kw">mod</span> (n <span class="kw">div</span> <span class="dv">2</span>)]-w*y2[i <span class="kw">mod</span> (n <span class="kw">div</span> <span class="dv">2</span>)];<span class="co">//蝴蝶操作</span></a>
<a class="sourceLine" id="cb1-35" title="35"> <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb1-36" title="36"> <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb1-37" title="37"><span class="kw">begin</span></a>
<a class="sourceLine" id="cb1-38" title="38">readln(s1);                    <span class="co">//输入两个数字，使用字符串</span></a>
<a class="sourceLine" id="cb1-39" title="39">readln(s2);</a>
<a class="sourceLine" id="cb1-40" title="40">n1:=length(s1);                <span class="co">//两个数分别的长度</span></a>
<a class="sourceLine" id="cb1-41" title="41">n2:=length(s2);</a>
<a class="sourceLine" id="cb1-42" title="42"><span class="kw">for</span> i:=<span class="dv">1</span> <span class="kw">to</span> n1 <span class="kw">do</span>              <span class="co">//转换</span></a>
<a class="sourceLine" id="cb1-43" title="43">a[n1-i]:=ord(s1[i])-<span class="dv">48</span>;</a>
<a class="sourceLine" id="cb1-44" title="44"><span class="kw">for</span> i:=<span class="dv">1</span> <span class="kw">to</span> n2 <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-45" title="45">b[n2-i]:=ord(s2[i])-<span class="dv">48</span>;</a>
<a class="sourceLine" id="cb1-46" title="46">n3:=n1+n2<span class="dv">-1</span>;                   <span class="co">//乘法后长度</span></a>
<a class="sourceLine" id="cb1-47" title="47"><span class="kw">if</span> trunc(math.log2(n3))&lt;math.log2(n3) <span class="kw">then</span><span class="co">//补位</span></a>
<a class="sourceLine" id="cb1-48" title="48">n3:=<span class="dv">2</span> <span class="kw">shl</span> trunc(math.log2(n3));</a>
<a class="sourceLine" id="cb1-49" title="49">fft(a,a,n3,<span class="dv">1</span>);                 <span class="co">//FFT</span></a>
<a class="sourceLine" id="cb1-50" title="50">fft(b,b,n3,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-51" title="51"><span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n3<span class="dv">-1</span> <span class="kw">do</span>            <span class="co">//插值</span></a>
<a class="sourceLine" id="cb1-52" title="52">c[i]:=a[i]*b[i];</a>
<a class="sourceLine" id="cb1-53" title="53">fft(c,c,n3,-<span class="dv">1</span>);                <span class="co">//IFFT</span></a>
<a class="sourceLine" id="cb1-54" title="54">fillchar(s,sizeof(s),<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb1-55" title="55"><span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n3<span class="dv">-1</span> <span class="kw">do</span>            <span class="co">//转换成十进制</span></a>
<a class="sourceLine" id="cb1-56" title="56"><span class="kw">begin</span></a>
<a class="sourceLine" id="cb1-57" title="57">inc(s[i],round(<span class="dt">real</span>(c[i])/n3));<span class="co">//这里IFFT后要除以n，注意！</span></a>
<a class="sourceLine" id="cb1-58" title="58">inc(s[i+<span class="dv">1</span>],s[i] <span class="kw">div</span> <span class="dv">10</span>);</a>
<a class="sourceLine" id="cb1-59" title="59">s[i]:=s[i] <span class="kw">mod</span> <span class="dv">10</span>;</a>
<a class="sourceLine" id="cb1-60" title="60"><span class="kw">end</span>;</a>
<a class="sourceLine" id="cb1-61" title="61"><span class="kw">while</span> (s[n3]=<span class="dv">0</span>) <span class="kw">and</span> (n3&gt;<span class="dv">0</span>) <span class="kw">do</span>  <span class="co">//去掉前导0</span></a>
<a class="sourceLine" id="cb1-62" title="62">dec(n3);</a>
<a class="sourceLine" id="cb1-63" title="63"><span class="kw">for</span> i:=n3 <span class="kw">downto</span> <span class="dv">0</span> <span class="kw">do</span>          <span class="co">//输出</span></a>
<a class="sourceLine" id="cb1-64" title="64"><span class="kw">write</span>(s[i]);</a>
<a class="sourceLine" id="cb1-65" title="65">writeln;</a>
<a class="sourceLine" id="cb1-66" title="66"><span class="kw">end</span>.</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1"><span class="pp">#include</span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="pp">#include</span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="pp">#include</span><span class="im">&lt;complex&gt;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="pp">#include</span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">using</span> <span class="kw">namespace</span> std;</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="at">const</span> <span class="dt">double</span> pi=acos(-<span class="dv">1</span>);      <span class="co">//圆周率，不解释</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">typedef</span> complex&lt;<span class="dt">double</span>&gt; cp;    <span class="co">//复数定义</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="dt">void</span> fft(cp a[<span class="dv">8192</span>],cp y[<span class="dv">8192</span>],<span class="dt">int</span> n,<span class="dt">int</span> s)</a>
<a class="sourceLine" id="cb2-9" title="9">{</a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="cf">if</span> (n==<span class="dv">1</span>)                  <span class="co">//边界条件</span></a>
<a class="sourceLine" id="cb2-11" title="11">    {</a>
<a class="sourceLine" id="cb2-12" title="12">        y[<span class="dv">0</span>]=a[<span class="dv">0</span>];</a>
<a class="sourceLine" id="cb2-13" title="13">        <span class="cf">return</span>;</a>
<a class="sourceLine" id="cb2-14" title="14">    }</a>
<a class="sourceLine" id="cb2-15" title="15">    cp f1[<span class="dv">8192</span>],f2[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n/<span class="dv">2</span>;i++)    <span class="co">//将数组分割成两部分</span></a>
<a class="sourceLine" id="cb2-17" title="17">    {</a>
<a class="sourceLine" id="cb2-18" title="18">        f1[i]=a[i*<span class="dv">2</span>];</a>
<a class="sourceLine" id="cb2-19" title="19">        f2[i]=a[i*<span class="dv">2</span>+<span class="dv">1</span>];</a>
<a class="sourceLine" id="cb2-20" title="20">    }</a>
<a class="sourceLine" id="cb2-21" title="21">    cp y1[<span class="dv">8192</span>],y2[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb2-22" title="22">    fft(f1,y1,n/<span class="dv">2</span>,s);          <span class="co">//递归</span></a>
<a class="sourceLine" id="cb2-23" title="23">    fft(f2,y2,n/<span class="dv">2</span>,s);</a>
<a class="sourceLine" id="cb2-24" title="24">    cp w;</a>
<a class="sourceLine" id="cb2-25" title="25">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n/<span class="dv">2</span>;i++)</a>
<a class="sourceLine" id="cb2-26" title="26">    {</a>
<a class="sourceLine" id="cb2-27" title="27">        w=exp(cp(<span class="dv">0</span>,<span class="dv">2</span>*pi*i*s/n));<span class="co">//复根的计算</span></a>
<a class="sourceLine" id="cb2-28" title="28">        y[i]=y1[i%(n/<span class="dv">2</span>)]+w*y2[i%(n/<span class="dv">2</span>)];<span class="co">//计算出结果</span></a>
<a class="sourceLine" id="cb2-29" title="29">        y[i+n/<span class="dv">2</span>]=y1[i%(n/<span class="dv">2</span>)]-w*y2[i%(n/<span class="dv">2</span>)];<span class="co">//蝴蝶操作</span></a>
<a class="sourceLine" id="cb2-30" title="30">    }</a>
<a class="sourceLine" id="cb2-31" title="31">}</a>
<a class="sourceLine" id="cb2-32" title="32"><span class="dt">int</span> main()</a>
<a class="sourceLine" id="cb2-33" title="33">{</a>
<a class="sourceLine" id="cb2-34" title="34">    <span class="dt">char</span> s1[<span class="dv">8192</span>],s2[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb2-35" title="35">    scanf(<span class="st">&quot;</span><span class="sc">%s\n%s</span><span class="st">&quot;</span>,&amp;s1,&amp;s2);   <span class="co">//输入两个数字，使用字符串</span></a>
<a class="sourceLine" id="cb2-36" title="36">    <span class="dt">int</span> n1,n2,n3;</a>
<a class="sourceLine" id="cb2-37" title="37">    n1=strlen(s1);             <span class="co">//两个数分别的长度</span></a>
<a class="sourceLine" id="cb2-38" title="38">    n2=strlen(s2);</a>
<a class="sourceLine" id="cb2-39" title="39">    cp a[<span class="dv">8192</span>],b[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb2-40" title="40">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n1;i++)     <span class="co">//转换</span></a>
<a class="sourceLine" id="cb2-41" title="41">    a[n1-i-<span class="dv">1</span>]=s1[i]-<span class="ch">&#39;0&#39;</span>;</a>
<a class="sourceLine" id="cb2-42" title="42">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n2;i++)</a>
<a class="sourceLine" id="cb2-43" title="43">    b[n2-i-<span class="dv">1</span>]=s2[i]-<span class="ch">&#39;0&#39;</span>;</a>
<a class="sourceLine" id="cb2-44" title="44">    n3=n1+n2-<span class="dv">1</span>;                <span class="co">//乘法后长度</span></a>
<a class="sourceLine" id="cb2-45" title="45">    <span class="cf">if</span> ((<span class="dt">int</span>)(log2(n3))&lt;log2(n3))<span class="co">//补位</span></a>
<a class="sourceLine" id="cb2-46" title="46">    n3=<span class="dv">2</span>&lt;&lt;(<span class="dt">int</span>)log2(n3);</a>
<a class="sourceLine" id="cb2-47" title="47">    fft(a,a,n3,<span class="dv">1</span>);             <span class="co">//FFT</span></a>
<a class="sourceLine" id="cb2-48" title="48">    fft(b,b,n3,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb2-49" title="49">    cp c[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb2-50" title="50">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n3;i++)     <span class="co">//插值</span></a>
<a class="sourceLine" id="cb2-51" title="51">    c[i]=a[i]*b[i];</a>
<a class="sourceLine" id="cb2-52" title="52">    fft(c,c,n3,-<span class="dv">1</span>);            <span class="co">//IFFT</span></a>
<a class="sourceLine" id="cb2-53" title="53">    <span class="dt">int</span> s[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb2-54" title="54">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n3;i++)     <span class="co">//转换成十进制</span></a>
<a class="sourceLine" id="cb2-55" title="55">    {</a>
<a class="sourceLine" id="cb2-56" title="56">        s[i]+=(<span class="dt">int</span>)(c[i].real()/n3+<span class="fl">0.5</span>);<span class="co">//这里IFFT后要除以n，注意！</span></a>
<a class="sourceLine" id="cb2-57" title="57">        s[i+<span class="dv">1</span>]+=s[i]/<span class="dv">10</span>;</a>
<a class="sourceLine" id="cb2-58" title="58">        s[i]%=<span class="dv">10</span>;</a>
<a class="sourceLine" id="cb2-59" title="59">    }</a>
<a class="sourceLine" id="cb2-60" title="60">    <span class="cf">for</span> (;!s[n3]&amp;&amp;n3;n3--);    <span class="co">//去掉前导0</span></a>
<a class="sourceLine" id="cb2-61" title="61">    <span class="cf">for</span> (<span class="dt">int</span> i=n3;i&gt;=<span class="dv">0</span>;i--)    <span class="co">//输出</span></a>
<a class="sourceLine" id="cb2-62" title="62">    printf(<span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span>,s[i]);</a>
<a class="sourceLine" id="cb2-63" title="63">    putchar(<span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>);</a>
<a class="sourceLine" id="cb2-64" title="64">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-65" title="65">}</a></code></pre></div>
<p><del>神奇的是，Pascal开了栈扩充以后，数组可以开好大，C++到了16384就炸了。</del></p>
<h3 id="-6">迭代版代码</h3>
<p>我们知道，递归版的跑的很慢，很浪费栈空间<del>废话</del>，还容易炸掉。所以，我们自然要把它改写成迭代版的。</p>
<p>我们来看看一个项数为8的函数通过分割后会怎么样：</p>
<p>$$a_0,a_1,a_2,a_3,a_4,a_5,a_6,a_7$$</p>
<p>$$\downarrow$$</p>
<p>$$a_0,a_2,a_4,a_6\quad a_1,a_3,a_5,a_7$$</p>
<p>$$\downarrow\quad\quad\quad\quad\quad\quad\downarrow$$</p>
<p>$$a_0,a_4\quad a_2,a_6\quad a_1,a_5\quad a_3,a_7$$</p>
<p>$$\downarrow\quad\quad\quad\downarrow\quad\quad\quad\downarrow\quad\quad\quad\downarrow$$</p>
<p>$$ a_0\quad a_4\quad a_2\quad a_6\quad a_1\quad a_5\quad a_3\quad a_7$$</p>
<p><del>话说用$\LaTeX$的排版不太好（不用图片的结果）</del>。</p>
<p>当然，$\{0,4,2,6,1,5,3,7\}$表面看上去没什么规律。</p>
<p>转换成二进制：$000,100,010,110,001,101,011,111$</p>
<p>好吧，还是看不出来，虽然有点感觉。再翻转看看：$000,001,010,011,100,101,110,111$</p>
<p>哇！这不是0到7吗？</p>
<p>那么，我们只要将初始的数组按顺序翻转，就能不断合并，就能完成FFT了。</p>
<p>迭代版代码：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode pascal"><code class="sourceCode pascal"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">uses</span></a>
<a class="sourceLine" id="cb3-2" title="2">math,imaginary;</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">type</span></a>
<a class="sourceLine" id="cb3-4" title="4">arr=<span class="kw">array</span>[<span class="dv">0</span>..<span class="dv">8191</span>]<span class="kw">of</span> complex;</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">var</span></a>
<a class="sourceLine" id="cb3-6" title="6">n1,n2,n3,i:<span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb3-7" title="7">a,b,c:arr;</a>
<a class="sourceLine" id="cb3-8" title="8">rev,s:<span class="kw">array</span>[<span class="dv">0</span>..<span class="dv">8191</span>]<span class="kw">of</span> <span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb3-9" title="9">s1,s2:<span class="dt">string</span>;</a>
<a class="sourceLine" id="cb3-10" title="10"><span class="kw">procedure</span> getrev(n:<span class="dt">longint</span>);   <span class="co">//获取开始的顺序</span></a>
<a class="sourceLine" id="cb3-11" title="11"> <span class="kw">var</span></a>
<a class="sourceLine" id="cb3-12" title="12"> i:<span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb3-13" title="13"> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-14" title="14"> rev[<span class="dv">0</span>]:=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb3-15" title="15"> <span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n<span class="dv">-1</span> <span class="kw">do</span>            <span class="co">//递推求解</span></a>
<a class="sourceLine" id="cb3-16" title="16"> rev[i]:=(rev[i <span class="kw">shr</span> <span class="dv">1</span>] <span class="kw">shr</span> <span class="dv">1</span>) <span class="kw">or</span> ((i <span class="kw">and</span> <span class="dv">1</span>) <span class="kw">shl</span> (trunc(math.log2(n))-<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb3-17" title="17"> <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb3-18" title="18"><span class="kw">procedure</span> fft(<span class="kw">var</span> a:arr;n,s:<span class="dt">longint</span>);</a>
<a class="sourceLine" id="cb3-19" title="19"> <span class="kw">var</span></a>
<a class="sourceLine" id="cb3-20" title="20"> i,j,k:<span class="dt">longint</span>;</a>
<a class="sourceLine" id="cb3-21" title="21"> w,t,x,y:complex;</a>
<a class="sourceLine" id="cb3-22" title="22"> <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-23" title="23"> <span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n<span class="dv">-1</span> <span class="kw">do</span>            <span class="co">//数组翻转</span></a>
<a class="sourceLine" id="cb3-24" title="24">  <span class="kw">if</span> i&lt;rev[i] <span class="kw">then</span></a>
<a class="sourceLine" id="cb3-25" title="25">  <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-26" title="26">  t:=a[i];</a>
<a class="sourceLine" id="cb3-27" title="27">  a[i]:=a[rev[i]];</a>
<a class="sourceLine" id="cb3-28" title="28">  a[rev[i]]:=t;</a>
<a class="sourceLine" id="cb3-29" title="29">  <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb3-30" title="30"> <span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> trunc(math.log2(n))-<span class="dv">1</span> <span class="kw">do</span><span class="co">//1 shl i是n的一半</span></a>
<a class="sourceLine" id="cb3-31" title="31">  <span class="kw">for</span> j:=<span class="dv">0</span> <span class="kw">to</span> n <span class="kw">div</span> (<span class="dv">2</span> <span class="kw">shl</span> i)-<span class="dv">1</span> <span class="kw">do</span><span class="co">//第j块</span></a>
<a class="sourceLine" id="cb3-32" title="32">   <span class="kw">for</span> k:=j <span class="kw">shl</span> (i+<span class="dv">1</span>) <span class="kw">to</span> j <span class="kw">shl</span> (i+<span class="dv">1</span>)+<span class="dv">1</span> <span class="kw">shl</span> i<span class="dv">-1</span> <span class="kw">do</span><span class="co">//k相当于递归版中的i</span></a>
<a class="sourceLine" id="cb3-33" title="33">   <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-34" title="34">   w:=exp(<span class="dt">comp</span>(<span class="dv">0</span>,pi/(<span class="dv">1</span> <span class="kw">shl</span> i)*k*s));<span class="co">//复根的计算</span></a>
<a class="sourceLine" id="cb3-35" title="35">   x:=a[k];</a>
<a class="sourceLine" id="cb3-36" title="36">   y:=w*a[k+<span class="dv">1</span> <span class="kw">shl</span> i];</a>
<a class="sourceLine" id="cb3-37" title="37">   a[k]:=x+y;                  <span class="co">//更新</span></a>
<a class="sourceLine" id="cb3-38" title="38">   a[k+<span class="dv">1</span> <span class="kw">shl</span> i]:=x-y;          <span class="co">//蝴蝶操作</span></a>
<a class="sourceLine" id="cb3-39" title="39">   <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb3-40" title="40"> <span class="kw">if</span> s=-<span class="dv">1</span> <span class="kw">then</span>                  <span class="co">//IFFT要除以n</span></a>
<a class="sourceLine" id="cb3-41" title="41">  <span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n<span class="dv">-1</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-42" title="42">  a[i]:=a[i]/n;</a>
<a class="sourceLine" id="cb3-43" title="43"> <span class="kw">end</span>;</a>
<a class="sourceLine" id="cb3-44" title="44"><span class="kw">begin</span>                          <span class="co">//基本上一样</span></a>
<a class="sourceLine" id="cb3-45" title="45">readln(s1);</a>
<a class="sourceLine" id="cb3-46" title="46">readln(s2);</a>
<a class="sourceLine" id="cb3-47" title="47">n1:=length(s1);</a>
<a class="sourceLine" id="cb3-48" title="48">n2:=length(s2);</a>
<a class="sourceLine" id="cb3-49" title="49"><span class="kw">for</span> i:=<span class="dv">1</span> <span class="kw">to</span> n1 <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-50" title="50">a[n1-i]:=ord(s1[i])-<span class="dv">48</span>;</a>
<a class="sourceLine" id="cb3-51" title="51"><span class="kw">for</span> i:=<span class="dv">1</span> <span class="kw">to</span> n2 <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-52" title="52">b[n2-i]:=ord(s2[i])-<span class="dv">48</span>;</a>
<a class="sourceLine" id="cb3-53" title="53">n3:=n1+n2<span class="dv">-1</span>;</a>
<a class="sourceLine" id="cb3-54" title="54"><span class="kw">if</span> trunc(math.log2(n3))&lt;math.log2(n3) <span class="kw">then</span></a>
<a class="sourceLine" id="cb3-55" title="55">n3:=<span class="dv">2</span> <span class="kw">shl</span> trunc(math.log2(n3));</a>
<a class="sourceLine" id="cb3-56" title="56">getrev(n3);</a>
<a class="sourceLine" id="cb3-57" title="57">fft(a,n3,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-58" title="58">fft(b,n3,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-59" title="59"><span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n3<span class="dv">-1</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-60" title="60">c[i]:=a[i]*b[i];</a>
<a class="sourceLine" id="cb3-61" title="61">fft(c,n3,-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb3-62" title="62">fillchar(s,sizeof(s),<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb3-63" title="63"><span class="kw">for</span> i:=<span class="dv">0</span> <span class="kw">to</span> n3<span class="dv">-1</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-64" title="64"><span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-65" title="65">inc(s[i],round(<span class="dt">real</span>(c[i])));</a>
<a class="sourceLine" id="cb3-66" title="66">inc(s[i+<span class="dv">1</span>],s[i] <span class="kw">div</span> <span class="dv">10</span>);</a>
<a class="sourceLine" id="cb3-67" title="67">s[i]:=s[i] <span class="kw">mod</span> <span class="dv">10</span>;</a>
<a class="sourceLine" id="cb3-68" title="68"><span class="kw">end</span>;</a>
<a class="sourceLine" id="cb3-69" title="69"><span class="kw">while</span> (s[n3]=<span class="dv">0</span>) <span class="kw">and</span> (n3&gt;<span class="dv">0</span>) <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-70" title="70">dec(n3);</a>
<a class="sourceLine" id="cb3-71" title="71"><span class="kw">for</span> i:=n3 <span class="kw">downto</span> <span class="dv">0</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-72" title="72"><span class="kw">write</span>(s[i]);</a>
<a class="sourceLine" id="cb3-73" title="73">writeln;</a>
<a class="sourceLine" id="cb3-74" title="74"><span class="kw">end</span>.</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="pp">#include</span><span class="im">&lt;cstdio&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="pp">#include</span><span class="im">&lt;cmath&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="pp">#include</span><span class="im">&lt;complex&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="pp">#include</span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw">using</span> <span class="kw">namespace</span> std; </a>
<a class="sourceLine" id="cb4-6" title="6"><span class="at">const</span> <span class="dt">double</span> pi=acos(-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">typedef</span> complex&lt;<span class="dt">double</span>&gt; cp;    <span class="co">//复数定义</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="dt">int</span> rev[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb4-9" title="9"><span class="dt">void</span> getrev(<span class="dt">int</span> n)</a>
<a class="sourceLine" id="cb4-10" title="10">{</a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++)</a>
<a class="sourceLine" id="cb4-12" title="12">    rev[i]=(rev[i&gt;&gt;<span class="dv">1</span>]&gt;&gt;<span class="dv">1</span>)|((i&amp;<span class="dv">1</span>)&lt;&lt;(<span class="dt">int</span>(log2(n))-<span class="dv">1</span>));</a>
<a class="sourceLine" id="cb4-13" title="13">}</a>
<a class="sourceLine" id="cb4-14" title="14"><span class="dt">void</span> fft(cp a[<span class="dv">8192</span>],<span class="dt">int</span> n,<span class="dt">int</span> s)</a>
<a class="sourceLine" id="cb4-15" title="15">{</a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++)      <span class="co">//数组翻转</span></a>
<a class="sourceLine" id="cb4-17" title="17">        <span class="cf">if</span> (i&lt;rev[i])</a>
<a class="sourceLine" id="cb4-18" title="18">        swap(a[i],a[rev[i]]);</a>
<a class="sourceLine" id="cb4-19" title="19">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">1</span>;i&lt;n;i*=<span class="dv">2</span>)     <span class="co">//i是n的一半</span></a>
<a class="sourceLine" id="cb4-20" title="20">        <span class="cf">for</span> (<span class="dt">int</span> j=<span class="dv">0</span>;j&lt;n;j+=i*<span class="dv">2</span>)<span class="co">//j是这一块的开始位置</span></a>
<a class="sourceLine" id="cb4-21" title="21">            <span class="cf">for</span> (<span class="dt">int</span> k=j;k&lt;i+j;k++)<span class="co">//k相当于递归版中的i</span></a>
<a class="sourceLine" id="cb4-22" title="22">            {</a>
<a class="sourceLine" id="cb4-23" title="23">                cp w=exp(cp(<span class="dv">0</span>,pi/i*k*s));<span class="co">//复根的计算</span></a>
<a class="sourceLine" id="cb4-24" title="24">                cp x=a[k],y=w*a[k+i];</a>
<a class="sourceLine" id="cb4-25" title="25">                a[k]=x+y;      <span class="co">//更新</span></a>
<a class="sourceLine" id="cb4-26" title="26">                a[k+i]=x-y;    <span class="co">//蝴蝶操作</span></a>
<a class="sourceLine" id="cb4-27" title="27">            }</a>
<a class="sourceLine" id="cb4-28" title="28">    <span class="cf">if</span> (s==-<span class="dv">1</span>)                 <span class="co">//IFFT要除以n</span></a>
<a class="sourceLine" id="cb4-29" title="29">        <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n;i++)</a>
<a class="sourceLine" id="cb4-30" title="30">        a[i]/=n;</a>
<a class="sourceLine" id="cb4-31" title="31">}</a>
<a class="sourceLine" id="cb4-32" title="32"><span class="dt">int</span> main()                     <span class="co">//基本上一样</span></a>
<a class="sourceLine" id="cb4-33" title="33">{</a>
<a class="sourceLine" id="cb4-34" title="34">    <span class="dt">char</span> s1[<span class="dv">8192</span>],s2[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb4-35" title="35">    scanf(<span class="st">&quot;</span><span class="sc">%s\n%s</span><span class="st">&quot;</span>,&amp;s1,&amp;s2);</a>
<a class="sourceLine" id="cb4-36" title="36">    <span class="dt">int</span> n1,n2,n3;</a>
<a class="sourceLine" id="cb4-37" title="37">    n1=strlen(s1);</a>
<a class="sourceLine" id="cb4-38" title="38">    n2=strlen(s2);</a>
<a class="sourceLine" id="cb4-39" title="39">    cp a[<span class="dv">8192</span>],b[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb4-40" title="40">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n1;i++)</a>
<a class="sourceLine" id="cb4-41" title="41">    a[n1-i-<span class="dv">1</span>]=s1[i]-<span class="ch">&#39;0&#39;</span>;</a>
<a class="sourceLine" id="cb4-42" title="42">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n2;i++)</a>
<a class="sourceLine" id="cb4-43" title="43">    b[n2-i-<span class="dv">1</span>]=s2[i]-<span class="ch">&#39;0&#39;</span>;</a>
<a class="sourceLine" id="cb4-44" title="44">    n3=n1+n2-<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb4-45" title="45">    <span class="cf">if</span> ((<span class="dt">int</span>)(log2(n3))&lt;log2(n3))</a>
<a class="sourceLine" id="cb4-46" title="46">    n3=<span class="dv">2</span>&lt;&lt;(<span class="dt">int</span>)log2(n3);</a>
<a class="sourceLine" id="cb4-47" title="47">    getrev(n3);</a>
<a class="sourceLine" id="cb4-48" title="48">    fft(a,n3,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-49" title="49">    fft(b,n3,<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-50" title="50">    cp c[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb4-51" title="51">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n3;i++)</a>
<a class="sourceLine" id="cb4-52" title="52">    c[i]=a[i]*b[i];</a>
<a class="sourceLine" id="cb4-53" title="53">    fft(c,n3,-<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb4-54" title="54">    <span class="dt">int</span> s[<span class="dv">8192</span>];</a>
<a class="sourceLine" id="cb4-55" title="55">    <span class="cf">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>;i&lt;n3;i++)</a>
<a class="sourceLine" id="cb4-56" title="56">    {</a>
<a class="sourceLine" id="cb4-57" title="57">        s[i]+=(<span class="dt">int</span>)(c[i].real()/n3+<span class="fl">0.5</span>);</a>
<a class="sourceLine" id="cb4-58" title="58">        s[i+<span class="dv">1</span>]+=s[i]/<span class="dv">10</span>;</a>
<a class="sourceLine" id="cb4-59" title="59">        s[i]%=<span class="dv">10</span>;</a>
<a class="sourceLine" id="cb4-60" title="60">    }</a>
<a class="sourceLine" id="cb4-61" title="61">    <span class="cf">for</span> (;!s[n3]&amp;&amp;n3;n3--);</a>
<a class="sourceLine" id="cb4-62" title="62">    <span class="cf">for</span> (<span class="dt">int</span> i=n3;i&gt;=<span class="dv">0</span>;i--)</a>
<a class="sourceLine" id="cb4-63" title="63">    printf(<span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span>,s[i]);</a>
<a class="sourceLine" id="cb4-64" title="64">    putchar(<span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>);</a>
<a class="sourceLine" id="cb4-65" title="65">    <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-66" title="66">}</a></code></pre></div>
<blockquote>
<p>其他：</p>
<p>FFT的可视化（翻译）：<a href="http://www.bilibili.com/video/av19141078">B站链接</a></p>
</blockquote>

                    </section>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 col-lg-offset-3 col-md-10 col-md-offset-1">
                    <section class="content-inner margin-top-no">
                        <hr>

                            <p>版权？ 不存在的。</p>
                            <p><a style="float:left" href="/link.html">友链</a><a style="float:right" href="/about.html">关于我</a></p>
                            <br>
                            <p>选择语言：
                            <p><a style="float:left" href="/setLanguage.html?pascal">Pascal</a><a style="float:right" href="/setLanguage.html?c++">C++</a></p>
                    </section>
                </div>
            </div>

            <div id="gitalk-container"></div>
            <script src="/js/gitalk.min.js"></script>
            <script>
            var gitalk = new Gitalk({
              clientID: '8fa4b6551a4d0d6a0d68',
              clientSecret: '829f1d6cc0a2247ae3f33a1744337464d26e65a4',
              repo: 'zhoushengjie.pw',
              owner: 'dblark',
              admin: ['dblark'],
              id: location.pathname,
              distractionFreeMode: false
            })
            gitalk.render('gitalk-container')
            </script>

    </main>





    <script src="/js/jquery.min.js"></script>
    <script src="/js/base.min.js"></script>
</body>
</html>
